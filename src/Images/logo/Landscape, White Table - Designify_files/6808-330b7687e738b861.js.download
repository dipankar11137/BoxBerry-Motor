"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6808],{55406:function(e,n,t){function r(e,n,t,r){var i=Math.max(Math.min(r,(t-1)/2),0),s=e-i,l=s<0?t+s:s,o=(e+i)%t;return l<o&&n>=l&&n<=o||l>=o&&(n>=l||n<=o)}t.d(n,{Z:function(){return r}})},26808:function(e,n,t){t.d(n,{I:function(){return ee}});var r=t(71874),i=t(53203),s=t(24037),l=t(388),o=t(35230),a=t.n(o),c=t(24246),u=t(27378),d=t(59389),f=t(29549),x=t(9345),h=t(21084),p=t(31923),m=t(34896),g=t(55892),v=t(46213),j=t(10043),y=t(60597),b=t(87228),w=t(1577),k=t(34412),C=t.n(k),D=t(79894),A=t.n(D),R=t(54837),S=(t(15560),t(97132)),E=t(79646),Z=t(71158),_=t(55021),I=t(68891),z=t(56552),M=t(86677),T=t.n(M),O=t(2926),F=t.n(O),W=t(41716),U=t(21326),H=t(63244),L=t(46007),P=t(93955),V=t(19790),q=t(73868),N=t(34130),B=t(72172),G=t(46608),Y=(0,u.forwardRef)((function(e,n){var t=function(e,n){v&&v(e,n)},l=e.currentlyVisible,o=e.truncatedTemplate,d=e.imageId,f=e.containerSize,x=e.shouldRender,h=e.onVisible,p=e.refetch,g=e.contextMenuElements,v=e.onContextMenuActionComplete,j=e.styles,y=(0,_.Z)(e,["currentlyVisible","truncatedTemplate","imageId","containerSize","shouldRender","onVisible","refetch","contextMenuElements","onContextMenuActionComplete","styles"]),b=(0,u.useRef)(null),w=(0,q.useSession)().data,k=(0,P.oR)().templateEditorStore,C=(0,B.H4)(),D=(0,z.useQuery)(["template",o.id,d],(0,r.Z)(a().mark((function e(){var n,t,r,i,s,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=I.stringify((0,Z.Z)({},"image-id",d),{skipNull:!0}),e.next=4,C(W.ZP.get("/templates/".concat(o.id,"?").concat(t)),{skipErrorHandling:function(e){var n,t,r;return 404===(null===(n=e.response)||void 0===n?void 0:n.status)||"IMAGE_ID_ERROR"===(null===(r=null===(t=e.response)||void 0===t?void 0:t.data.errors[0])||void 0===r?void 0:r.code)}});case 4:if(r=e.sent,i=r.data,s=r.status,l=r.apiErrors,404!==s){e.next=12;break}T().replace("/404"),e.next=17;break;case 12:if(!l||"IMAGE_ID_ERROR"!==(null===(n=l[0])||void 0===n?void 0:n.code)){e.next=16;break}T().replace("/design-not-found"),e.next=17;break;case 16:return e.abrupt("return",null===i||void 0===i?void 0:i.data);case 17:case"end":return e.stop()}}),e)}))),{refetchOnMount:p}),A=D.isLoading,R=D.data,E=(0,H.ke)(o.aspectRatio,{width:f.width,height:Math.max(f.height-60,0)});return(0,u.useEffect)((function(){R&&l&&h(R)}),[R,l,h]),(0,u.useImperativeHandle)(n,(function(){return{download:function(){return(0,r.Z)(a().mark((function e(){var n,t,r,l,o,c,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(l=null===w||void 0===w||null===(n=w.user)||void 0===n||null===(t=n.subscriptions)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.active)){e.next=11;break}return k.setProcessing(!0),e.next=6,C((0,N.Z)(R.id,d));case 6:o=e.sent.data,F().saveAs(o,(0,L.Z)(R.name,"png")),k.setProcessing(!1),e.next=12;break;case 11:null===(u=null===(c=b.current)||void 0===c?void 0:c.toCanvas((0,s.Z)((0,i.Z)({},E),{x:0,y:0,mimeType:"image/png",quality:1,pixelRatio:(0,V.Z)(E)})))||void 0===u||u.toBlob((function(e){F().saveAs(e,(0,L.Z)(R.name,"png"))}));case 12:return e.abrupt("return",null!==l&&void 0!==l&&l);case 13:case"end":return e.stop()}}),e)})))()}}})),x?(0,c.jsxs)(m.kC,(0,s.Z)((0,i.Z)({flexDirection:"column",alignItems:"center"},j),{children:[(0,c.jsx)(S.M2,{condition:!d&&!!g&&g.length>0,wrapper:function(e){return(0,c.jsx)(S.xV,{elements:null!==g&&void 0!==g?g:[],breakPoint:"lg",onActionComplete:t,children:e})},children:(0,c.jsx)(U.Z,(0,i.Z)({ref:b,loading:A,template:R,canvasSize:E,shouldRender:x},y))}),(0,c.jsx)(m.xv,{noOfLines:1,width:(0,G.Z)(E).width,textAlign:"center",color:"gray.500",fontSize:"sm",height:"".concat(60,"px"),pt:2,children:R&&R.name})]})):(0,c.jsx)(c.Fragment,{})})),K=Y,Q=t(55406);function $(){var e=(0,l.Z)(["\n                .chakra-modal__content-container {\n                  justify-content: flex-end !important;\n                }\n              "]);return $=function(){return e},e}function J(){var e=(0,l.Z)(["\n              .carousel-root {\n                width: 100%;\n                flex-grow: 1;\n              }\n\n              .carousel,\n              .carousel .slider-wrapper,\n              .carousel .slider {\n                height: 100%;\n              }\n\n              .carousel .slide {\n                background: none;\n              }\n            "]);return J=function(){return e},e}var X=(0,d.m$)(f.zx,{baseStyle:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",position:"absolute",top:{base:"-16px",lg:"-30px"},fontSize:{base:"24px",md:"48",lg:"60px"},zIndex:5,color:"gray.400"}}),ee=function(e){var n=e.category,t=e.currentTemplateId,l=e.imageId,o=e.onTemplateChange,d=e.onTemplateUpdate,k=e.onTemplateDelete,D=function(){Ze(),fe(!0),(0,E.q)("automate_from_preview","website_automation")},Z=function(e){Y(e)},_=function(e,t){var r=n.templates.length;return t===e||t===(e-1<0?r-1:e-1)||t===(e+1>r-1?0:e+1)},z=function(e){var n;return!!(null===O||void 0===O||null===(n=O.user)||void 0===n?void 0:n.id)&&O.user.id===e.userId},T=function(e,n){e!==B.oD.AUTOMATE?e!==B.oD.DOWNLOAD?n&&n.success&&(e===B.oD.RENAME&&G?d((0,s.Z)((0,i.Z)({},G),{name:n.data})):e===B.oD.DELETE&&G&&(Ee.current=!0,k(G.id))):_e():D()},O=(0,q.useSession)().data,F=(0,M.useRouter)(),W=(0,x.pm)(),U=(0,u.useRef)(),H=n.templates.findIndex((function(e){return e.id===t})),L=(0,u.useState)(H>-1?H:0),P=L[0],V=L[1],N=(0,u.useState)(null),G=N[0],Y=N[1],ee=(0,u.useRef)(n.templates.reduce((function(e,n){return e[n.id]=(0,u.createRef)(),e}),{})),ne=l?"?iid=".concat(l):"",te=l?"/gallery/?image-id=".concat(l):"/gallery/",re="/templates/".concat(t,"/edit/").concat(ne),ie=C()(),se=ie.ref,le=ie.height,oe=void 0===le?1:le,ae=ie.width,ce=void 0===ae?1:ae,ue=(0,u.useState)(!1),de=ue[0],fe=ue[1],xe=(0,u.useState)(!1),he=xe[0],pe=xe[1],me=(0,h.qY)(),ge=me.isOpen,ve=me.onOpen,je=me.onClose,ye=(0,p.Sx)({base:!0,lg:!1}),be=(0,u.useRef)(null),we=(0,u.useRef)(null),ke=(0,u.useMemo)((function(){return[B.oD.AUTOMATE,B.oD.DOWNLOAD]}),[]),Ce=(0,B.qP)({template:null!==G&&void 0!==G?G:void 0,renameModalRef:be,deleteModalRef:we,mock:ke}),De=(0,u.useState)(!0),Ae=De[0],Re=De[1],Se=(0,u.useRef)(null),Ee=(0,u.useRef)(!1);(0,u.useEffect)((function(){F.query.saved&&!U.current&&(U.current=W({id:"toast-saved-template",position:"top",duration:6e3,render:function(){return(0,c.jsx)(S.FN,{text:"Design successfully saved."})}}),F.replace(I.exclude(F.asPath,["saved"]),void 0,{shallow:!0}))})),(0,u.useEffect)((function(){!1!==Ee.current&&(Ee.current=!1,Re(!1),Se.current=P,V(-1),setTimeout((function(){if(null!==Se.current){var e=Se.current+1>=n.templates.length?n.templates.length-1:Se.current;V(e),o(n.templates[e].id),Re(!0)}}),0))}),[n,P,o]);var Ze=(0,u.useCallback)((function(){U.current&&W.close(U.current)}),[W]);function _e(){return Ie.apply(this,arguments)}function Ie(){return Ie=(0,r.Z)(a().mark((function e(){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:G&&(null===(n=ee.current[G.id].current)||void 0===n||n.download().then((function(e){return!e&&pe(!0)})),(0,E.q)("download_from_preview","image"),(0,E.T)(G.id));case 1:case"end":return e.stop()}}),e)}))),Ie.apply(this,arguments)}function ze(){return(ze=(0,r.Z)(a().mark((function e(n,t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return je(),e.next=3,n.action(t);case 3:r=e.sent,T(n.type,r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(0,u.useEffect)((function(){return Ze}),[Ze]);var Me=n.templates.length;return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(m.kC,{flexDir:"column",height:"100%",children:[!l&&G&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(S.tt,{ref:be,template:G}),(0,c.jsx)(S.pf,{ref:we,template:G})]}),!l&&ye&&ge&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(j.xB,{styles:(0,j.iv)($())}),(0,c.jsxs)(g.u_,{isOpen:ge,onClose:je,size:"full",motionPreset:"none",children:[(0,c.jsx)(g.ZA,{}),(0,c.jsxs)(g.hz,{m:0,borderRadius:0,width:"auto",children:[(0,c.jsx)(g.xB,{}),(0,c.jsx)(g.ol,{size:"lg"}),(0,c.jsx)(g.fe,{px:8,my:6,children:(0,c.jsx)(m.aV,{display:"flex",flexDir:"column",color:"gray.600",spacing:2,children:Ce.map((function(e,n){return(0,c.jsx)(m.HC,{children:(0,c.jsx)(f.zx,{variant:"unstyled",display:"block",fontWeight:"normal",height:"auto",width:"100%",textAlign:"left",py:1,onClick:function(n){return function(e,n){return ze.apply(this,arguments)}(e,n)},children:e.text})},n)}))})})]})]})]}),(0,c.jsxs)(m.W2,{display:"flex",maxW:"container.lg",justifyContent:"space-between",alignItems:"center",pt:{base:4,lg:24},pb:6,px:4,children:[(0,c.jsx)(m.xu,{flex:"1 1 0px",children:(0,c.jsx)(A(),{passHref:!0,scroll:!1,href:te,children:(0,c.jsxs)(m.rU,{_hover:{textDecoration:"none"},variant:"unstyled",display:"flex",alignItems:"center",color:"gray.600",fontWeight:"700",children:[(0,c.jsx)(y.Ao2,{size:18}),(0,c.jsx)(m.xv,{noOfLines:1,maxWidth:{base:140,lg:"unset"},ml:1.5,children:"All Designs"})]})})}),ye&&(0,c.jsx)(c.Fragment,{children:O&&!l&&Ce.length>0?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.kC,{flex:"1 1 0px",justifyContent:"center",children:(0,c.jsx)(A(),{href:"/",passHref:!0,children:(0,c.jsx)(m.rU,{children:(0,c.jsx)(v.Ei,{alt:"Designify",height:{base:"28px",lg:"32px"},display:{base:"block",lg:"none"},src:"/logo_color.svg"})})})}),(0,c.jsx)(m.xu,{flex:"1 1 0px",textAlign:"right",children:(0,c.jsx)(f.zx,{variant:"unstyled",onClick:ve,children:(0,c.jsx)(m.kC,{p:3,gridGap:1,display:{base:"flex",lg:"none"},children:Array.from({length:3}).map((function(e,n){return(0,c.jsx)(m.xu,{w:".25rem",height:".25rem",borderRadius:"50%",bgColor:"black"},n)}))})})})]}):(0,c.jsx)(c.Fragment,{children:(0,c.jsx)(A(),{href:"/",passHref:!0,children:(0,c.jsx)(m.rU,{children:(0,c.jsx)(v.Ei,{alt:"Designify",height:{base:"28px",lg:"32px"},display:{base:"block",lg:"none"},src:"/designify_logo_color_dark.svg"})})})})})]}),(0,c.jsxs)(m.W2,{ref:se,flex:"1",display:"flex",maxW:"container.lg",overflow:"hidden",justifyContent:"center",alignItems:"center",position:"relative",px:{base:4,md:12,lg:16},children:[(0,c.jsx)(j.xB,{styles:(0,j.iv)(J())}),n.templates.length>1&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(X,{variant:"unstyled",left:{base:"-12px",md:"-4px",lg:0},onClick:function(){V(P-1)},children:(0,c.jsx)(b.bUI,{})}),(0,c.jsx)(X,{variant:"unstyled",right:{base:"-12px",md:"-4px",lg:0},onClick:function(){V(P+1)},children:(0,c.jsx)(b.Dli,{})})]}),(0,c.jsx)(m.xu,{display:"flex",flexDirection:"column",width:"100%",height:"100%",children:Ae&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(m.xv,{noOfLines:1,textAlign:"center",color:"gray.500",fontSize:"sm",pb:2,children:"".concat(n.name," ").concat(P+1," of ").concat(n.templates.length)}),(0,c.jsx)(R.lr,{infiniteLoop:!0,autoPlay:!1,showStatus:!1,showIndicators:!1,showThumbs:!1,showArrows:!1,selectedItem:P,onChange:function(e){V(e),o(n.templates[e].id)},children:n.templates.map((function(e,n){return(0,Q.Z)(P,n,Me,3)?(0,c.jsx)(K,{ref:ee.current[e.id],currentlyVisible:P===n,shouldRender:_(P,n),truncatedTemplate:e,imageId:l,containerSize:{width:ce,height:oe-30},onVisible:Z,refetch:z(e),contextMenuElements:Ce,onContextMenuActionComplete:T,styles:{height:"100%",justifyContent:"center"}},e.id):(0,c.jsx)(m.xu,{},e.id)}))})]})})]}),(0,c.jsxs)(m.kC,{justifyContent:"center",pt:4,pb:{base:4,lg:6},children:[(0,c.jsx)(A(),{passHref:!0,href:re,children:(0,c.jsxs)(m.rU,{_hover:{textDecoration:"none"},textAlign:"center",display:"flex",flexDir:"column",justifyContent:"center",alignItems:"center",height:"auto",fontSize:"sm",width:{base:24,lg:32},color:"gray.900",fontWeight:"600",onClick:function(){(0,E.q)("edit_from_preview","editor",!1)},children:[(0,c.jsx)(w.dY,{color:"gray.900",flexShrink:0,fontSize:{base:"3rem",lg:"4rem"}}),"Edit"]})}),(0,c.jsxs)(f.zx,{variant:"unstyled",textAlign:"center",display:"flex",flexDir:"column",justifyContent:"center",height:"auto",fontSize:"sm",width:{base:24,lg:32},mx:{base:8,lg:20},onClick:D,children:[(0,c.jsx)(w.ZK,{color:"gray.900",flexShrink:0,fontSize:{base:"3rem",lg:"4rem"}}),"Start Batch"]}),(0,c.jsxs)(f.zx,{variant:"unstyled",textAlign:"center",display:"flex",flexDir:"column",justifyContent:"center",height:"auto",fontSize:"sm",width:{base:24,lg:32},onClick:_e,children:[(0,c.jsx)(w.tx,{color:"palette.2",flexShrink:0,fontSize:{base:"3rem",lg:"4rem"}}),"Download"]})]})]}),G&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(S.rA,{template:G,open:de,onClose:function(){fe(!1)}}),(0,c.jsx)(S.DI,{active:he}),(0,c.jsx)(S._v,{open:he,onClose:function(){pe(!1)},template:G,redirectUrl:"/pricing"})]})]})}}}]);